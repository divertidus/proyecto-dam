<ion-header>
  <ion-toolbar>
    <ion-title>
      Editando - {{ diaEntrenamientoBackup.descripcion }} ({{ diaEntrenamientoBackup.fechaEntrenamiento | date:
      'dd/MM/yyyy' }})
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="content-adjusted" fullscreen>
  <ng-container *ngFor="let ejercicio of diaEntrenamientoBackup.ejerciciosRealizados; let i = index">
    <ion-card class="exercise-card-custom">
      <ion-card-header (click)="toggleEjercicio(i)" class="exercise-header-custom">
        <ion-card-title class="exercise-header">
          <div class="exercise-header-content">
            <!-- Título del ejercicio -->
            <span class="exercise-title">{{ ejercicio.nombreEjercicioRealizado || 'Ejercicio Sin Nombre' }}</span>

            <!-- Contador de series -->
            <span class="progress-indicator small-text">{{ ejercicio.seriesCompletadas || 0 }} / {{
              ejercicio.seriesTotal || 1 }}</span>

            <!-- Icono para abrir notas de ejercicio -->
            <ion-icon name="document-text-outline" class="icono-notas"
              (click)="abrirNotasEjercicio(i); $event.stopPropagation()"></ion-icon>

            <!-- Icono de papelera en rojo para eliminar el ejercicio -->
            <ion-icon name="trash-outline" color="danger" class="icono-papelera"
              (click)="confirmarEliminarEjercicio(i); $event.stopPropagation()"></ion-icon>
          </div>
        </ion-card-title>
      </ion-card-header>

      <ion-card-content *ngIf="ejercicioAbiertoIndex === i">
        <div class="exercise-container">
          <!-- Descripción del ejercicio, si existe -->
          <p *ngIf="ejercicio.notas">Nota del ejercicio: {{ ejercicio.notas }}</p>

          <!-- Series del Ejercicio -->
          <ng-container *ngFor="let serie of ejercicio.series; let j = index">
            <div class="exercise-row">
              <span class="series-number">S{{ j + 1 }}.</span>
              <ion-input type="number" [(ngModel)]="serie.repeticiones" class="reps-input" placeholder="Reps"
                [disabled]="!serie.enEdicion">
              </ion-input>

              <div class="weight-control">
                <button class="control-button minus" (click)="decrementarPeso(serie)"
                  [disabled]="!serie.enEdicion">-</button>
                <ion-input type="number" [(ngModel)]="serie.peso" class="weight-input"
                  [placeholder]="serie.pesoAnterior?.toString() || '0'" [disabled]="!serie.enEdicion">
                </ion-input>
                <button class="control-button plus" (click)="incrementarPeso(serie)"
                  [disabled]="!serie.enEdicion">+</button>
                <span *ngIf="serie.pesoAnterior" class="weight-label">({{ serie.pesoAnterior }} kg)</span>

                <!-- Icono para notas de la serie -->
                <ion-icon *ngIf="serie.enEdicion" name="clipboard-outline" class="note-icon"
                  (click)="abrirNotasSerie(i, j)"></ion-icon>
              </div>

              <div class="action-buttons">
                <ion-button fill="clear" size="small" (click)="toggleEditarSerie(i, j)" class="ok-button"
                  [disabled]="serie.peso === 0 || serie.repeticiones === 0">
                  {{ serie.enEdicion ? 'OK' : 'EDIT' }}
                </ion-button>
              </div>

              <ion-icon *ngIf="j === ejercicio.series.length - 1" name="trash-outline" class="delete-icon delete-right"
                (click)="confirmarEliminarSerie(i, j)">
              </ion-icon>
            </div>

            <!-- Checkbox para opciones adicionales (al fallo, dolor, con ayuda) -->
            <div class="checkbox-row centered-checkboxes">
              <label class="checkbox-label">
                <ion-checkbox mode="ios" [(ngModel)]="serie.alFallo" [disabled]="!serie.enEdicion"
                  class="checkbox-plain"></ion-checkbox>
                <span>Fallo</span>
              </label>
              <label class="checkbox-label">
                <ion-checkbox mode="ios" [(ngModel)]="serie.dolor" [disabled]="!serie.enEdicion"
                  class="checkbox-plain"></ion-checkbox>
                <span>Dolor</span>
              </label>
              <label class="checkbox-label">
                <ion-checkbox mode="ios" [(ngModel)]="serie.conAyuda" [disabled]="!serie.enEdicion"
                  class="checkbox-plain"></ion-checkbox>
                <span>Ayuda</span>
              </label>
            </div>

            <!-- Nota de la serie -->
            <div *ngIf="serie.notas" class="note-display">
              <span>Nota de la serie: {{ serie.notas }}</span>
            </div>
          </ng-container>

          <ion-button *ngIf="mostrarBotonAnadirSerie(ejercicio)" expand="block" fill="outline"
            (click)="confirmarAnadirSerie(i)">
            Añadir Serie Extra
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- Botón para añadir ejercicio extra -->
  <!-- Cambia ion-card por un div para eliminar estilos de borde no deseados -->
  <div class="boton-anadir-ejercicio-card">
    <ion-button expand="block" fill="solid" (click)="agregarEjercicioExtra()" class="boton-anadir-ejercicio">
      <ion-icon name="add-circle-outline"></ion-icon> Añadir Ejercicio Extra
    </ion-button>
  </div>
</ion-content>


<ion-footer class="fixed-footer">
  <ion-toolbar>
    <!--  <ion-button expand="block" color="success" (click)="agregarEjercicioExtra()">
      <ion-icon name="add-circle-outline"></ion-icon> Añadir Ejercicio Extra
    </ion-button> -->
    <ion-button expand="full" (click)="guardarCambios()">Guardar Cambios</ion-button>
    <ion-button expand="full" color="danger" (click)="confirmarCancelarEdicion()">Cancelar</ion-button>
  </ion-toolbar>
</ion-footer>